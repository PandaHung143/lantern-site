<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Before 2025 Ends</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }

/* ğŸŒŒ Background */
body { height: 100vh; overflow: hidden; background: radial-gradient(circle at bottom, #141414 0%, #000 70%); color: white; }

/* ğŸ“ Center content */
.container { position: absolute; top: 36%; width: 100%; text-align: center; z-index: 10; }
h1 { font-weight: 500; opacity: 0.9; }
textarea { width: 330px; height: 90px; margin-top: 18px; padding: 10px; border-radius: 10px; border: none; resize: none; font-size: 14px; }
button { margin-top: 14px; padding: 10px 26px; border-radius: 22px; border: none; cursor: pointer; background: #ffcc77; color: #000; font-weight: 500; }

/* ğŸµ Audio controls */
.audio-controls { position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 12px; opacity: 0.6; z-index: 20; }
.audio-controls button { font-size: 18px; background: none; border: none; cursor: pointer; color: white; }
.audio-controls input[type="range"] { width: 130px; }

/* ğŸ® Lantern */
.lantern { position: absolute; bottom: -40px; width: 18px; height: 24px; border-radius: 50%; background: #ffcc66; opacity: 0.9; animation-timing-function: linear, ease-in-out; }

/* ğŸˆ Float upward */
@keyframes floatUp {
  from { transform: translateX(0) translateY(0); opacity: 1; }
  to { transform: translateX(var(--drift)) translateY(-120vh); opacity: 0; }
}

/* ğŸ’« Glow pulse */
@keyframes glowPulse {
  0% { box-shadow: 0 0 6px rgba(255,200,100,0.4), 0 0 12px rgba(255,160,80,0.2); }
  50% { box-shadow: 0 0 14px rgba(255,230,150,0.8), 0 0 34px rgba(255,180,90,0.6); }
  100% { box-shadow: 0 0 6px rgba(255,200,100,0.4), 0 0 12px rgba(255,160,80,0.2); }
}

/* ğŸ«§ Lantern message bubble */
.lantern-message {
  position: absolute;
  bottom: 28px;
  left: 50%;
  transform: translateX(-50%);
  max-width: 240px;
  padding: 6px 10px;
  border-radius: 12px;
  font-size: 12px;
  color: #fff;
  background: rgba(20,20,20,0.6);
  backdrop-filter: blur(2px);
  text-align: center;
  opacity: 0.9;
  pointer-events: none;
  animation: messageFloat 6s ease-out forwards;
  box-shadow: 0 0 8px rgba(255,200,100,0.35);
}
@keyframes messageFloat {
  0%   { transform: translate(-50%, 0); opacity: 0; }
  10%  { opacity: 0.9; }
  80%  { transform: translate(-50%, -40px); opacity: 0.9; }
  100% { transform: translate(-50%, -60px); opacity: 0; }
}

/* ğŸ“œ Credits */
.credits {
  position: fixed; bottom: 10px; width: 100%; text-align: center; font-size: 12px;
  color: #ffcc77; opacity: 0.8;
  text-shadow: 0 0 6px rgba(255,200,100,0.6), 0 0 12px rgba(255,160,80,0.4);
  animation: glowPulse 3s ease-in-out infinite;
}
</style>
</head>

<body>

<div class="container">
  <h1>What do you want to say before 2025 ends?</h1>
  <textarea placeholder="Type it here..."></textarea><br>
  <button id="sendBtn">Send</button>
</div>

<!-- ğŸµ Audio -->
<audio id="bg-music" src="c418-subwoofer-lullaby.mp3" loop></audio>

<div class="audio-controls">
  <button id="muteBtn">ğŸ”‡</button>
  <input id="volumeSlider" type="range" min="0" max="100" value="50">
</div>

<!-- ğŸ“œ Credits -->
<div class="credits">
  Music: C418 â€“ Subwoofer Lullaby Â· Webpage idea & creation: PandaHung143
</div>

<!-- ğŸ”¥ App logic + Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, addDoc, collection, onSnapshot, serverTimestamp, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

const firebaseConfig = {
  apiKey: "AIzaSyB8zL977IZcxN0Fvs1fehLtGko4B85z3JI",
  authDomain: "lantern-site.firebaseapp.com",
  projectId: "lantern-site",
  storageBucket: "lantern-site.appspot.com",
  messagingSenderId: "551494553450",
  appId: "1:551494553450:web:d26588c63cf3ec397c1f13",
  measurementId: "G-ZECV8QC6X8"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app); 

/* ---------- UI refs ---------- */
const audio = document.getElementById("bg-music");
const volumeSlider = document.getElementById("volumeSlider");
const muteBtn = document.getElementById("muteBtn");
const sendBtn = document.getElementById("sendBtn");
const textarea = document.querySelector("textarea");

let unlocked = false;
let typingTimeout;

/* ---------- Audio behavior ---------- */
audio.load();

function fadeInMusic(targetVolume = 0.5, duration = 4000) {
  let current = 0;
  const step = targetVolume / (duration / 50);
  audio.volume = 0;
  const fade = setInterval(() => {
    current += step;
    if (current >= targetVolume) { audio.volume = targetVolume; clearInterval(fade); }
    else { audio.volume = current; }
  }, 50);
}

document.addEventListener("click", () => {
  if (!unlocked) {
    audio.play().catch(() => {});
    fadeInMusic(volumeSlider.value / 100);
    unlocked = true;
    muteBtn.textContent = "ğŸ”Š";
  }
}, { once: true });

volumeSlider.addEventListener("input", () => {
  audio.volume = volumeSlider.value / 100;
  muteBtn.textContent = audio.volume === 0 ? "ğŸ”‡" : "ğŸ”Š";
});

muteBtn.addEventListener("click", () => {
  if (audio.volume > 0) { audio.volume = 0; muteBtn.textContent = "ğŸ”‡"; }
  else { audio.volume = volumeSlider.value / 100; muteBtn.textContent = "ğŸ”Š"; }
});

textarea.addEventListener("input", () => {
  const normal = volumeSlider.value / 100;
  audio.volume = Math.min(normal, 0.15);
  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => { audio.volume = volumeSlider.value / 100; }, 1200);
});

window.addEventListener("beforeunload", () => {
  let current = audio.volume;
  const step = current / (1000 / 50);
  const fade = setInterval(() => {
    current -= step;
    if (current <= 0) { audio.volume = 0; clearInterval(fade); }
    else { audio.volume = current; }
  }, 50);
});

/* ---------- Lanterns ---------- */
function createLantern(messageText = "") {
  const lantern = document.createElement("div");
  lantern.className = "lantern";

  const x = Math.random() * window.innerWidth;
  const drift = (Math.random() * 120 - 60) + "px";

  const duration = Math.random
